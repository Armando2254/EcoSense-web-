<!DOCTYPE html>
<html lang="es">
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contenedores</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    
    <!-- NAVBAR -->
    <nav class="navbar">
      <p class="eco">Panel de Administrador</p>
      <ul class="opciones">
        <li class="opcion"><a href="../Contenedores/index.html">Contenedores</a></li>
        <li class="opcion"><a href="../Estadisticas/index.html">Estadísticas</a></li>
        <li class="opcion"><a href="../Recolectores/index.html">Recolectores</a></li>
        <li class="opcion"><a href="../rutas/index.html">Rutas</a></li>
        <li class="opcion"><a href="../Perfil/index.html">Perfil</a></li>
        <img class="picture-user" src="../assets/images/PicUser.png" alt="UserPicture">
      </ul>
    </nav>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main">
<div class="search-section">
  <input type="text" placeholder="Buscar contenedor por ID" />
  <button class="btn-search"><i class="fas fa-search"></i> Buscar</button>
  <button class="btn-edit"><i class="fas fa-edit"></i> Modificar</button>
  <button class="btn-delete"><i class="fas fa-trash-alt"></i> Eliminar</button>
</div>


      <div class="table-container" id="contenedor-lista">
        <!-- Contenedores se insertan dinámicamente -->
      </div>
    </main>

    <footer class="footer">
      <div class="footer-left">
        <div class="social-icons">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
      <div class="footer-right">
        <div class="footer-columns">
          <div class="column">
            <h4>Proyecto</h4>
            <p>Visión</p>
            <p>Misión</p>
            <p>Objetivos</p>
          </div>
          <div class="column">
            <h4>Soporte</h4>
            <p>FAQ</p>
            <p>Contacto</p>
            <p>Ayuda</p>
          </div>
          <div class="column">
            <h4>Legal</h4>
            <p>Términos</p>
            <p>Privacidad</p>
            <p>Licencias</p>
          </div>
        </div>
      </div>
    </footer>

    <!-- MODAL DETALLES -->
    <div id="modalContenedor" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="modalNombre"></h2>
        <p><strong>Porcentaje:</strong> <span id="modalPorcentaje"></span>%</p>
        <p><strong>Ubicación:</strong> <span id="modalUbicacion"></span></p>
        <p><strong>Latitud:</strong> <span id="modalLatitud"></span></p>
        <p><strong>Longitud:</strong> <span id="modalLongitud"></span></p>
        <div class="modal-buttons">
          <button id="btnCerrarModal">Cerrar</button>
        </div>
      </div>
    </div>

    <!-- MODAL EDITAR -->
    <div id="modalEditar" class="modal" style="display:none;">
      <div class="modal-content">
        <h2>Editar Contenedor</h2>
        <input id="editId" type="hidden" />
        <input id="editNombre" placeholder="Nombre" />
        <input id="editPorcentaje" type="number" placeholder="Porcentaje" />
        <input id="editDireccion" placeholder="Dirección" />
        <input id="editLat" placeholder="Latitud" />
        <input id="editLng" placeholder="Longitud" />
        <div class="modal-buttons">
          <button id="btnGuardarEdicion">Guardar</button>
          <button onclick="document.getElementById('modalEditar').style.display='none'">Cancelar</button>
        </div>
      </div>
    </div>

    <script>
      const apiUrl = "http://localhost:5033/api/contenedor";

      // Obtener contenedores
      async function obtenerContenedores() {
        const res = await fetch(apiUrl);
        const contenedores = await res.json();
        const contenedorLista = document.getElementById("contenedor-lista");
        contenedorLista.innerHTML = "";
        contenedores.forEach(c => {
          const tarjeta = document.createElement("div");
          tarjeta.classList.add("contenedor-card");
          tarjeta.innerHTML = `
            <h3>${c.nombre}</h3>
            <p><strong>ID:</strong> ${c.id}</p>
            <p><strong>% Llenado:</strong> ${c.porcentaje}%</p>
            <p><strong>Ubicación:</strong> ${c.ubicacion}</p>
            <button onclick='verDetalles(${JSON.stringify(c)})'>Ver</button>
            <button onclick='mostrarEditar(${JSON.stringify(c)})'>Editar</button>
          `;
          contenedorLista.appendChild(tarjeta);
        });
      }

      // Ver detalles
      function verDetalles(c) {
        document.getElementById("modalNombre").textContent = c.nombre;
        document.getElementById("modalPorcentaje").textContent = c.porcentaje;
        document.getElementById("modalUbicacion").textContent = c.ubicacion;
        document.getElementById("modalLatitud").textContent = c.lat;
        document.getElementById("modalLongitud").textContent = c.lng;
        document.getElementById("modalContenedor").style.display = "block";
      }

      document.getElementById("btnCerrarModal").addEventListener("click", () => {
        document.getElementById("modalContenedor").style.display = "none";
      });

      // Mostrar modal de edición
      function mostrarEditar(c) {
        document.getElementById("editId").value = c.id;
        document.getElementById("editNombre").value = c.nombre;
        document.getElementById("editPorcentaje").value = c.porcentaje;
        document.getElementById("editDireccion").value = c.ubicacion;
        document.getElementById("editLat").value = c.lat;
        document.getElementById("editLng").value = c.lng;
        document.getElementById("modalEditar").style.display = "block";
      }

      // Guardar edición
      document.getElementById("btnGuardarEdicion").addEventListener("click", async () => {
        const id = document.getElementById("editId").value;
        const contenedorEditado = {
          id,
          nombre: document.getElementById("editNombre").value,
          porcentaje: parseInt(document.getElementById("editPorcentaje").value),
          ubicacion: document.getElementById("editDireccion").value,
          lat: document.getElementById("editLat").value,
          lng: document.getElementById("editLng").value,
        };
        await fetch(`${apiUrl}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(contenedorEditado),
        });
        document.getElementById("modalEditar").style.display = "none";
        obtenerContenedores();
      });

      // Eliminar
      document.getElementById("btnEliminar").addEventListener("click", async () => {
        const id = document.getElementById("inputBuscarId").value;
        if (!id) return alert("Ingresa un ID");
        if (!confirm("¿Estás seguro de eliminar este contenedor?")) return;
        await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
        obtenerContenedores();
      });

      // Modificar (cargar modal)
      document.getElementById("btnModificar").addEventListener("click", async () => {
        const id = document.getElementById("inputBuscarId").value;
        if (!id) return alert("Ingresa un ID");
        const res = await fetch(`${apiUrl}/${id}`);
        const c = await res.json();
        mostrarEditar(c);
      });

      // Cargar contenedores al iniciar
      obtenerContenedores();
    </script>
</body>
</html>